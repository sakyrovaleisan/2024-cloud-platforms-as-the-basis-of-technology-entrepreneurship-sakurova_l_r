# Feedback Telegram Bot

Простой Telegram-бот для сбора обратной связи. Бот позволяет пользователям
оставлять сообщения, ведёт статистику по авторам, уведомляет администратора и
предоставляет инструменты экспорта и очистки данных.

## Возможности

- Основные команды
  - `/start` — приветствие и краткая инструкция по использованию бота.
  - `/help` — список доступных команд с кратким описанием.
  - `/feedback <текст>` — мгновенная отправка обратной связи в одно сообщение.
  - `/feedback` — пошаговый диалог: бот запросит текст и сохранит ваш ответ.
  - `/cancel` — отмена диалога по вводу обратной связи.

- Статистика и аналитика
  - `/stats` — общее количество сообщений и топ пользователей по числу сообщений.
  - Статистика обновляется автоматически при каждом новом сообщении.

- Администрирование
  - `/export` — экспорт всех записей в CSV-файл и отправка администратору.
  - `/clear` — полная очистка локального хранилища (JSON).
  - Уведомления администратору при поступлении каждой новой обратной связи.

- Справочник сотрудников (данные из `employees.csv`)
  - `/employees` — общее количество сотрудников и распределение по отделам.
  - `/find_employee <запрос>` — поиск по имени или роли (частичное совпадение, до 10 результатов).
  - `/department <название>` — список сотрудников в конкретном отделе.
  - `/employee_email <имя>` — быстрый доступ к email по имени сотрудника.

- Хранение данных
  - Локальный файл `feedback.json` (JSON-структура: список записей и простая статистика).
  - Каждая запись включает время, ID пользователя, имя, username и текст сообщения.
  - Файл `employees.csv` используется только для чтения и хранит четыре столбца: `name`, `department`, `role`, `email`.

- Надёжность и удобство
  - Обработка ошибок с понятными сообщениями пользователю.
  - Переменные окружения через `.env` (`BOT_TOKEN`, `ADMIN_CHAT_ID`).
  - Ограничение запросов и корректная работа в режиме `polling`.

Все сообщения сохраняются в файле `feedback.json`. При появлении новой записи
администратор получает уведомление от бота в свой чат (`ADMIN_CHAT_ID`).

## Требования

- Python 3.10 или новее
- Установленные зависимости из `requirements.txt`
- Зарегистрированный Telegram-бот и его токен

## Настройка

1. Клонируйте репозиторий или скопируйте файлы проекта.
2. Создайте виртуальное окружение (рекомендуется):
   ```bash
   python3 -m venv .venv
   source .venv/bin/activate
   ```
3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
4. Скопируйте файл `.env.example` в `.env` и заполните значения:
   ```bash
   cp .env.example .env
   ```
   - `BOT_TOKEN` — токен вашего Telegram-бота.
   - `ADMIN_CHAT_ID` — числовой идентификатор чата администратора, которому будут
     приходить уведомления и доступны команды `/export` и `/clear`.

## Запуск

```bash
python bot.py
```

После запуска бот начнёт опрос обновлений (`polling`). Файл `feedback.json`
создаётся автоматически при первом получении данных.

## Хранилище данных

Файл `feedback.json` содержит:

- список всех сообщений с отметкой времени и информацией о пользователе;
- простую статистику: общее количество сообщений и счётчик для каждого
  пользователя.

Для экспорта данных используется команда `/export`, которая отправляет CSV-файл
в ответ администратору. Команда `/clear` полностью очищает хранилище.

## Работа с файлом сотрудников

- Файл `employees.csv` должен находиться рядом с `bot.py` и иметь структуру:

  ```text
  name,department,role,email
  Иван Иванов,IT,Developer,ivan@company.com
  Мария Петрова,HR,Manager,maria@company.com
  ...
  ```

- Бот читает файл только при первом запросе или перезапуске. Если формат
  нарушен, пользователю выводится понятная ошибка.
- Команды `/employees`, `/find_employee`, `/department` и `/employee_email`
  работают по данным CSV-файла и не изменяют его содержимое.

## Дополнительно

- Команда `/cancel` доступна в диалоге после `/feedback` без текста и отменяет
  ввод сообщения.
- При возникновении ошибок бот сообщает пользователю и пишет подробности в лог.
# Лабораторные работы 1-3
Этот репозиторий создан для выполнения лабораторных работ.
